{% extends '_base.html' %}
{% csrf_token %}

{% block title %}
	Post Listing
{% endblock %}

{% block extra_head %}

{% endblock %}


{% block content %}
    {% csrf_token %}

  <div id="app" class="max-w-7xl mx-auto mt-6">
    <div id="posts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Posts will be rendered here -->
    </div>
  </div>

{% endblock %}


{% block extra_body %}

 <script>
    const data = [
      {
        "id": 1,
        "title": "Iphone 16",
        "description": "تست توضیحات :)",
        "laddered": false,
        "user": 1,
        "location": 77,
        "created_at": "2024-12-11T14:34:16.349094+03:30",
        "images": []
      },
      {
        "id": 5,
        "title": "wpdjw",
        "description": "pwjdw",
        "laddered": true,
        "user": 1,
        "location": 45,
        "created_at": "2024-12-11T14:46:33.902103+03:30",
        "images": [
          {
            "image": "http://localhost:8000/storage/media/images/2024/12/11/car_qopdih6.png",
            "caption": "wpdjw",
            "is_cover": true,
            "post": 5
          }
        ]
      },
      {
        "id": 6,
        "title": "tttttt1",
        "description": "bbbbbbbb1",
        "laddered": false,
        "user": 1,
        "location": 43,
        "created_at": "2024-12-11T15:03:34.951690+03:30",
        "images": []
      }
    ];

    const postsContainer = document.getElementById('posts');

    data.forEach(post => {
      const coverImage = post.images.find(img => img.is_cover)?.image || 'https://via.placeholder.com/150';
      const ladderedClass = post.laddered
        ? 'bg-red-200 border-red-500 relative'
        : 'bg-white border';
      const ladderedBadge = post.laddered
        ? `<span class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded">پله شده</span>`
        : '';

      // Convert to Persian date
      const persianDate = new Intl.DateTimeFormat('fa-IR', { dateStyle: 'long', timeStyle: 'short' }).format(new Date(post.created_at));

      const postHTML = `
        <div onclick="showpostinfo(${post.id})" class="cursor-pointer shadow-lg rounded-lg overflow-hidden border ${ladderedClass}">
          ${ladderedBadge}
          <img src="${coverImage}" alt="${post.title}" class="w-full h-48 object-cover">
          <div class="p-4">
            <h2 class="text-lg font-bold">${post.title}</h2>
            <p class="text-gray-600 text-sm">${post.description}</p>
            <p class="text-gray-400 text-xs mt-2">تاریخ: ${persianDate}</p>
          </div>
        </div>
      `;
      postsContainer.innerHTML += postHTML;
    });

    // Empty function for onClick
    function showpostinfo(postId) {
      console.log(`Clicked on post with ID: ${postId}`);
      // Function body to be implemented later
    }
  </script>

{% endblock %}
